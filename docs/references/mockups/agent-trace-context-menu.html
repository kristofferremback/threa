<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Trace - Context Menu Access</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ========================================
         GOLDEN THREAD THEME
         ======================================== */
      :root {
        --background: 40 20% 98%;
        --foreground: 30 10% 12%;
        --card: 40 15% 99%;
        --primary: 38 65% 50%;
        --primary-foreground: 40 20% 98%;
        --muted: 35 12% 93%;
        --muted-foreground: 30 8% 45%;
        --border: 35 15% 88%;
      }

      .dark {
        --background: 30 15% 8%;
        --foreground: 35 15% 92%;
        --card: 30 12% 11%;
        --primary: 40 55% 55%;
        --primary-foreground: 30 15% 8%;
        --muted: 30 10% 15%;
        --muted-foreground: 35 10% 55%;
        --border: 30 10% 20%;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Space Grotesk", system-ui, sans-serif;
        background: hsl(var(--background));
        color: hsl(var(--foreground));
        line-height: 1.6;
        padding: 40px 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 12px;
      }

      .subtitle {
        font-size: 16px;
        color: hsl(var(--muted-foreground));
        margin-bottom: 48px;
      }

      .principle-box {
        background: hsl(var(--primary) / 0.08);
        border: 1px solid hsl(var(--primary) / 0.2);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 48px;
      }

      .principle-title {
        font-size: 18px;
        font-weight: 700;
        color: hsl(var(--primary));
        margin-bottom: 12px;
      }

      .principle-list {
        font-size: 14px;
        line-height: 1.8;
      }

      .principle-list strong {
        color: hsl(var(--foreground));
      }

      .demo-section {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 32px;
      }

      .section-header {
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid hsl(var(--border));
      }

      .section-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .section-desc {
        font-size: 13px;
        color: hsl(var(--muted-foreground));
      }

      /* ========================================
         MESSAGE STREAM
         ======================================== */
      .stream-container {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        padding: 0;
        overflow: hidden;
      }

      .stream-header {
        padding: 16px 24px;
        border-bottom: 1px solid hsl(var(--border));
        font-size: 13px;
        font-weight: 600;
        color: hsl(var(--muted-foreground));
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .stream-content {
        padding: 24px;
      }

      .message {
        display: flex;
        gap: 14px;
        margin-bottom: 20px;
        position: relative;
      }

      .message-avatar {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        font-weight: 600;
        background: hsl(var(--muted));
        color: hsl(var(--foreground));
      }

      .message.ai .message-avatar {
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
      }

      .message-content {
        flex: 1;
        padding-top: 2px;
      }

      .message-header {
        display: flex;
        align-items: baseline;
        gap: 8px;
        margin-bottom: 4px;
      }

      .message-author {
        font-weight: 600;
        font-size: 14px;
      }

      .message.ai .message-author {
        color: hsl(var(--primary));
      }

      .message-time {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
      }

      .message-text {
        font-size: 14px;
        line-height: 1.6;
      }

      .message.ai {
        background: linear-gradient(90deg, hsl(var(--primary) / 0.06) 0%, transparent 100%);
        margin-left: -24px;
        margin-right: -24px;
        padding: 16px 24px;
        border-left: 3px solid hsl(var(--primary));
      }

      /* Message Menu Button */
      .message-menu {
        position: absolute;
        top: 16px;
        right: 24px;
        opacity: 0;
        transition: opacity 0.15s ease;
      }

      .message.ai:hover .message-menu {
        opacity: 1;
      }

      .message-menu-btn {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.15s ease;
      }

      .message-menu-btn:hover {
        background: hsl(var(--muted));
      }

      .message-menu-btn svg {
        width: 16px;
        height: 16px;
        color: hsl(var(--muted-foreground));
      }

      /* Context Menu */
      .context-menu {
        position: absolute;
        top: 48px;
        right: 24px;
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
        min-width: 180px;
        z-index: 100;
        display: none;
        overflow: hidden;
      }

      .context-menu.show {
        display: block;
      }

      .context-menu-item {
        padding: 10px 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        color: hsl(var(--foreground));
        transition: background 0.15s ease;
      }

      .context-menu-item:hover {
        background: hsl(var(--muted));
      }

      .context-menu-item svg {
        width: 16px;
        height: 16px;
        color: hsl(var(--muted-foreground));
      }

      .context-menu-divider {
        height: 1px;
        background: hsl(var(--border));
        margin: 4px 0;
      }

      /* Session Event */
      .session-event {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        background: hsl(var(--muted) / 0.5);
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        font-size: 14px;
        color: hsl(var(--muted-foreground));
        cursor: pointer;
        transition: all 0.15s ease;
        margin-bottom: 20px;
      }

      .session-event:hover {
        background: hsl(var(--muted));
        border-color: hsl(var(--primary));
      }

      .session-status {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
      }

      .status-dot.running {
        background: hsl(var(--primary));
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }

      .session-step {
        margin-left: auto;
        color: hsl(var(--muted-foreground));
        font-size: 13px;
      }

      /* ========================================
         MODAL
         ======================================== */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 40px;
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 900px;
        max-height: 85vh;
        display: flex;
        flex-direction: column;
        animation: modalSlideIn 0.2s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .modal-header {
        padding: 24px;
        border-bottom: 1px solid hsl(var(--border));
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .modal-title svg {
        width: 20px;
        height: 20px;
        color: hsl(var(--primary));
      }

      .modal-close {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        background: transparent;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: hsl(var(--muted-foreground));
        transition: background 0.15s ease;
      }

      .modal-close:hover {
        background: hsl(var(--muted));
      }

      .modal-close svg {
        width: 20px;
        height: 20px;
      }

      .modal-body {
        overflow-y: auto;
        flex: 1;
      }

      /* Trace Sections */
      .trace-section {
        padding: 24px;
        border-bottom: 1px solid hsl(var(--border));
      }

      .trace-section:last-child {
        border-bottom: none;
      }

      .trace-section-title {
        font-size: 14px;
        font-weight: 600;
        color: hsl(var(--muted-foreground));
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 16px;
      }

      .trace-step {
        padding: 16px;
        background: hsl(var(--muted) / 0.3);
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        margin-bottom: 12px;
      }

      .trace-step:last-child {
        margin-bottom: 0;
      }

      .step-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .step-icon {
        width: 18px;
        height: 18px;
        color: hsl(var(--primary));
      }

      .step-type {
        font-weight: 600;
        font-size: 14px;
      }

      .step-timestamp {
        margin-left: auto;
        color: hsl(var(--muted-foreground));
        font-size: 12px;
      }

      .step-content {
        color: hsl(var(--muted-foreground));
        font-size: 14px;
        line-height: 1.6;
        padding-left: 28px;
      }

      .step-content code {
        background: hsl(var(--muted));
        padding: 2px 6px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 13px;
      }

      /* Step Sources */
      .step-sources {
        margin-top: 12px;
        padding-left: 28px;
      }

      .sources-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        background: hsl(var(--muted) / 0.5);
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        font-size: 12px;
        font-weight: 500;
        color: hsl(var(--muted-foreground));
        cursor: pointer;
        transition: all 0.15s;
        user-select: none;
      }

      .sources-toggle:hover {
        background: hsl(var(--muted));
        border-color: hsl(var(--primary) / 0.3);
        color: hsl(var(--foreground));
      }

      .sources-toggle.expanded {
        background: hsl(var(--primary) / 0.1);
        border-color: hsl(var(--primary) / 0.3);
        color: hsl(var(--primary));
      }

      .sources-count {
        background: hsl(var(--muted));
        color: hsl(var(--muted-foreground));
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 600;
      }

      .sources-toggle.expanded .sources-count {
        background: hsl(var(--primary) / 0.2);
        color: hsl(var(--primary));
      }

      .sources-chevron {
        width: 12px;
        height: 12px;
        transition: transform 0.2s;
      }

      .sources-toggle.expanded .sources-chevron {
        transform: rotate(90deg);
      }

      .sources-list {
        margin-top: 10px;
        display: none;
        gap: 8px;
        flex-direction: column;
      }

      .sources-toggle.expanded + .sources-list {
        display: flex;
      }

      .source-card {
        padding: 10px 12px;
        background: hsl(var(--muted) / 0.3);
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        transition: all 0.15s;
      }

      .source-card:hover {
        background: hsl(var(--muted) / 0.5);
        border-color: hsl(var(--primary) / 0.2);
      }

      .source-card-header {
        display: flex;
        align-items: flex-start;
        gap: 8px;
      }

      .source-icon {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
        margin-top: 2px;
      }

      .source-icon.web {
        color: hsl(200 70% 50%);
      }

      .source-icon.workspace {
        color: hsl(var(--primary));
      }

      .source-info {
        flex: 1;
        min-width: 0;
      }

      .source-title {
        font-weight: 600;
        font-size: 13px;
        margin-bottom: 2px;
        color: hsl(var(--foreground));
      }

      .source-title a {
        color: inherit;
        text-decoration: none;
      }

      .source-title a:hover {
        color: hsl(var(--primary));
        text-decoration: underline;
      }

      .source-meta {
        font-size: 11px;
        color: hsl(var(--muted-foreground));
      }

      .source-snippet {
        margin-top: 6px;
        font-size: 12px;
        color: hsl(var(--muted-foreground));
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Dark Mode Toggle */
      .theme-toggle {
        position: fixed;
        top: 24px;
        right: 24px;
        z-index: 100;
      }

      .theme-toggle-btn {
        padding: 10px 16px;
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: hsl(var(--foreground));
        transition: background 0.15s ease;
      }

      .theme-toggle-btn:hover {
        background: hsl(var(--muted));
      }
    </style>
  </head>
  <body>
    <div class="theme-toggle">
      <button class="theme-toggle-btn" onclick="toggleTheme()">Toggle Dark Mode</button>
    </div>

    <div class="container">
      <h1>Agent Trace - Context Menu Access</h1>
      <p class="subtitle">Clean message view with trace and sources accessible via context menu (Slack-style)</p>

      <div class="principle-box">
        <div class="principle-title">Design Principle</div>
        <div class="principle-list">
          <strong>Sources don't get prime real-estate in the stream.</strong> They're available on-demand through a
          context menu (like Slack's "..." menu). Click "View trace" to see full agent session steps with sources inline
          on each step. Sources are collapsible with a toggle—during generation they're expanded, but automatically
          collapse when the next step begins (like Claude.ai). This keeps the trace clean while maintaining full
          transparency.
        </div>
      </div>

      <div class="demo-section">
        <div class="section-header">
          <div class="section-title">Message Stream</div>
          <div class="section-desc">
            Hover over the AI message to reveal the "..." menu. Click to access trace with sources.
          </div>
        </div>

        <div class="stream-container">
          <div class="stream-header">Stream: My Scratchpad</div>
          <div class="stream-content">
            <div class="message">
              <div class="message-avatar">K</div>
              <div class="message-content">
                <div class="message-header">
                  <span class="message-author">Kristoffer</span>
                  <span class="message-time">2:34 PM</span>
                </div>
                <div class="message-text">
                  @ariadne What are the key differences between PostgreSQL and MySQL for a startup SaaS application?
                </div>
              </div>
            </div>

            <div class="session-event" onclick="openTraceModal()">
              <div class="session-status">
                <div class="status-dot"></div>
                <strong>Agent Session</strong>
              </div>
              <div class="session-step">Completed in 3.2s</div>
              <svg
                style="width: 16px; height: 16px; color: hsl(var(--muted-foreground))"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>

            <div class="message ai">
              <div class="message-menu">
                <button class="message-menu-btn" onclick="toggleContextMenu(event, 'menu1')">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
                    />
                  </svg>
                </button>
                <div class="context-menu" id="menu1">
                  <div class="context-menu-item" onclick="openTraceModal()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z"
                      />
                    </svg>
                    View trace
                  </div>
                  <div class="context-menu-divider"></div>
                  <div class="context-menu-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                      />
                    </svg>
                    Copy message
                  </div>
                  <div class="context-menu-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
                      />
                    </svg>
                    Save as memo
                  </div>
                </div>
              </div>

              <div class="message-avatar">A</div>
              <div class="message-content">
                <div class="message-header">
                  <span class="message-author">Ariadne</span>
                  <span class="message-time">2:34 PM</span>
                </div>
                <div class="message-text">
                  Great question! Both are excellent choices, but there are some key differences to consider for a
                  startup SaaS application:
                  <br /><br />
                  <strong>PostgreSQL strengths:</strong>
                  <br />• More advanced features (JSON support, full-text search, CTEs) <br />• Better handling of
                  complex queries and concurrent writes <br />• Stricter data integrity and ACID compliance <br />•
                  Extensible with custom types and functions <br /><br />
                  <strong>MySQL strengths:</strong>
                  <br />• Simpler to set up and manage <br />• Faster for simple read-heavy workloads <br />• More
                  managed hosting options <br />• Larger ecosystem and community <br /><br />
                  For a modern SaaS application, I'd recommend PostgreSQL. The JSON support is particularly valuable for
                  flexible schemas, and the advanced query capabilities will serve you well as your data model evolves.
                  Plus, services like Supabase and Neon make PostgreSQL as easy to deploy as MySQL ever was.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="traceModal" onclick="closeTraceModalOnBackdrop(event)">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            Agent Trace
          </div>
          <button class="modal-close" onclick="closeTraceModal()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <!-- Session Steps -->
          <div class="trace-section">
            <div class="trace-section-title">Session Steps</div>

            <div class="trace-step">
              <div class="step-header">
                <svg class="step-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                  />
                </svg>
                <span class="step-type">Thinking</span>
                <span class="step-timestamp">2:34:01 PM</span>
              </div>
              <div class="step-content">
                Analyzing the question about PostgreSQL vs MySQL for a SaaS application. Need to research current best
                practices and provide balanced comparison.
              </div>
            </div>

            <div class="trace-step">
              <div class="step-header">
                <svg class="step-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                  />
                </svg>
                <span class="step-type">Tool Call</span>
                <span class="step-timestamp">2:34:02 PM</span>
              </div>
              <div class="step-content">
                <code>search_web("PostgreSQL vs MySQL 2024 comparison SaaS")</code>
              </div>
            </div>

            <div class="trace-step">
              <div class="step-header">
                <svg class="step-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                <span class="step-type">Tool Result</span>
                <span class="step-timestamp">2:34:02 PM</span>
              </div>
              <div class="step-content">Found 3 relevant sources with detailed comparison information</div>
              <div class="step-sources">
                <div class="sources-toggle" onclick="toggleSources(event, 'sources-1')">
                  <svg class="sources-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                  <span>Sources</span>
                  <span class="sources-count">3</span>
                </div>
                <div class="sources-list" id="sources-1">
                  <div class="source-card">
                    <div class="source-card-header">
                      <svg class="source-icon web" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
                        />
                      </svg>
                      <div class="source-info">
                        <div class="source-title">
                          <a href="#">PostgreSQL vs MySQL: Which Database Is Best?</a>
                        </div>
                        <div class="source-meta">digitalocean.com</div>
                        <div class="source-snippet">
                          PostgreSQL offers superior support for concurrent writes and complex queries. Its MVCC
                          implementation allows for better handling of simultaneous transactions, which is crucial for
                          SaaS applications with multiple users...
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="source-card">
                    <div class="source-card-header">
                      <svg class="source-icon web" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
                        />
                      </svg>
                      <div class="source-info">
                        <div class="source-title">
                          <a href="#">Modern Database Choices for Startups (2024)</a>
                        </div>
                        <div class="source-meta">news.ycombinator.com</div>
                        <div class="source-snippet">
                          The JSON/JSONB support in PostgreSQL has become a game-changer for SaaS applications. You get
                          the flexibility of a document database with the reliability of SQL. Services like Supabase and
                          Neon have also made PostgreSQL deployment as simple as MySQL...
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="source-card">
                    <div class="source-card-header">
                      <svg class="source-icon workspace" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                        />
                      </svg>
                      <div class="source-info">
                        <div class="source-title">
                          <a href="#">Database Selection Guide</a>
                        </div>
                        <div class="source-meta">Engineering Docs</div>
                        <div class="source-snippet">
                          For our internal SaaS products, we standardized on PostgreSQL after comparing both options.
                          The deciding factors were: better JSON support for flexible schemas, stronger data integrity
                          guarantees...
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="trace-step">
              <div class="step-header">
                <svg class="step-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                  />
                </svg>
                <span class="step-type">Response</span>
                <span class="step-timestamp">2:34:03 PM</span>
              </div>
              <div class="step-content">
                Generated comprehensive comparison highlighting PostgreSQL advantages for modern SaaS applications
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Theme Toggle
      function toggleTheme() {
        document.body.classList.toggle("dark")
      }

      // Context Menu
      let currentMenu = null

      function toggleContextMenu(event, menuId) {
        event.stopPropagation()
        const menu = document.getElementById(menuId)

        // Close other menus
        document.querySelectorAll(".context-menu").forEach((m) => {
          if (m.id !== menuId) m.classList.remove("show")
        })

        menu.classList.toggle("show")
        currentMenu = menu.classList.contains("show") ? menu : null
      }

      // Close menu when clicking outside
      document.addEventListener("click", (event) => {
        if (currentMenu && !event.target.closest(".context-menu") && !event.target.closest(".message-menu-btn")) {
          currentMenu.classList.remove("show")
          currentMenu = null
        }
      })

      // Trace Modal
      function openTraceModal() {
        document.getElementById("traceModal").classList.add("show")
        document.body.style.overflow = "hidden"

        // Close any open context menus
        if (currentMenu) {
          currentMenu.classList.remove("show")
          currentMenu = null
        }
      }

      function closeTraceModal() {
        document.getElementById("traceModal").classList.remove("show")
        document.body.style.overflow = ""
      }

      function closeTraceModalOnBackdrop(event) {
        if (event.target === event.currentTarget) {
          closeTraceModal()
        }
      }

      // Close modal on Escape key
      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          closeTraceModal()
        }
      })

      // Sources Toggle
      function toggleSources(event, sourcesId) {
        event.stopPropagation()
        const toggle = event.currentTarget
        toggle.classList.toggle("expanded")
      }
    </script>
  </body>
</html>
