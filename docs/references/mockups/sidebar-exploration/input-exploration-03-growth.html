<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Growth Behavior - Threa Design</title>
    <style>
      :root {
        --background: 30 15% 8%;
        --foreground: 35 20% 90%;
        --card: 30 12% 12%;
        --card-foreground: 35 20% 90%;
        --popover: 30 12% 10%;
        --popover-foreground: 35 20% 90%;
        --primary: 38 65% 50%;
        --primary-foreground: 30 15% 8%;
        --secondary: 30 10% 18%;
        --secondary-foreground: 35 20% 90%;
        --muted: 30 10% 20%;
        --muted-foreground: 35 15% 55%;
        --accent: 30 12% 18%;
        --accent-foreground: 35 20% 90%;
        --border: 30 10% 20%;
        --input: 30 10% 15%;
        --ring: 38 65% 50%;
        --radius: 0.75rem;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: hsl(var(--background));
        color: hsl(var(--foreground));
        line-height: 1.6;
        padding: 40px;
      }

      h1 {
        font-size: 28px;
        margin-bottom: 8px;
        color: hsl(var(--foreground));
      }

      .subtitle {
        color: hsl(var(--muted-foreground));
        margin-bottom: 40px;
        font-size: 15px;
      }

      .section {
        margin-bottom: 60px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: hsl(var(--foreground));
      }

      .section-desc {
        color: hsl(var(--muted-foreground));
        margin-bottom: 24px;
        font-size: 14px;
        max-width: 600px;
      }

      /* Demo container - simulates stream view */
      .demo-container {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        overflow: hidden;
        max-width: 700px;
      }

      /* Stream view simulation */
      .stream-view {
        height: 300px;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        transition: height 0.2s ease;
      }

      .message {
        padding: 12px 16px;
        background: hsl(var(--secondary));
        border-radius: 8px;
        font-size: 14px;
      }

      .message-author {
        font-weight: 600;
        font-size: 13px;
        margin-bottom: 4px;
        color: hsl(var(--primary));
      }

      /* Input wrapper - this is the key component */
      .input-wrapper {
        border-top: 1px solid hsl(var(--border));
        background: hsl(var(--popover));
        transition: all 0.2s ease;
      }

      /* Attachment bar */
      .attachment-bar {
        display: none;
        flex-wrap: wrap;
        gap: 8px;
        padding: 12px 16px;
        border-bottom: 1px solid hsl(var(--border));
        background: hsl(var(--card));
        max-height: 120px;
        overflow-y: auto;
      }

      .attachment-bar.has-attachments {
        display: flex;
      }

      .attachment-chip {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        background: hsl(var(--primary) / 0.1);
        border: 1px solid hsl(var(--primary) / 0.3);
        border-radius: 8px;
        font-size: 12px;
        color: hsl(var(--primary));
      }

      .attachment-chip.uploading {
        border-style: dashed;
        background: transparent;
        color: hsl(var(--muted-foreground));
        border-color: hsl(var(--border));
      }

      .attachment-chip .spinner {
        width: 14px;
        height: 14px;
        border: 2px solid hsl(var(--border));
        border-top-color: hsl(var(--primary));
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .attachment-chip .remove {
        cursor: pointer;
        opacity: 0.6;
        transition: opacity 0.15s;
      }

      .attachment-chip .remove:hover {
        opacity: 1;
      }

      /* Input area */
      .input-area {
        padding: 12px 16px;
        display: flex;
        gap: 12px;
        align-items: flex-end;
      }

      .input-field {
        flex: 1;
        min-height: 40px;
        max-height: 200px;
        overflow-y: auto;
        padding: 10px 14px;
        background: hsl(var(--input));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        font-size: 14px;
        color: hsl(var(--foreground));
        outline: none;
        transition:
          border-color 0.15s,
          box-shadow 0.15s;
        line-height: 1.5;
      }

      .input-field:focus {
        border-color: hsl(var(--primary) / 0.5);
        box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);
      }

      .input-field:empty::before {
        content: attr(data-placeholder);
        color: hsl(var(--muted-foreground));
      }

      .send-btn {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
        border: none;
        border-radius: 10px;
        cursor: pointer;
        flex-shrink: 0;
      }

      /* Height indicator */
      .height-indicator {
        position: absolute;
        right: -60px;
        top: 0;
        bottom: 0;
        width: 50px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        font-size: 10px;
        color: hsl(var(--muted-foreground));
        font-family: monospace;
      }

      .height-indicator::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 1px;
        background: hsl(var(--border));
      }

      /* Controls */
      .controls {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }

      .control-btn {
        padding: 8px 14px;
        background: hsl(var(--secondary));
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        color: hsl(var(--foreground));
        font-size: 13px;
        cursor: pointer;
        transition: all 0.15s;
      }

      .control-btn:hover {
        background: hsl(var(--accent));
        border-color: hsl(var(--primary) / 0.3);
      }

      .control-btn.active {
        background: hsl(var(--primary) / 0.2);
        border-color: hsl(var(--primary));
        color: hsl(var(--primary));
      }

      /* Behavior comparison */
      .comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 32px;
        margin-top: 24px;
      }

      .comparison-item {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 12px;
        overflow: hidden;
      }

      .comparison-header {
        padding: 12px 16px;
        border-bottom: 1px solid hsl(var(--border));
        font-weight: 600;
        font-size: 14px;
        background: hsl(var(--secondary));
      }

      .comparison-content {
        padding: 16px;
      }

      .comparison-desc {
        font-size: 13px;
        color: hsl(var(--muted-foreground));
        margin-bottom: 16px;
      }

      .comparison-visual {
        background: hsl(var(--background));
        border-radius: 8px;
        padding: 12px;
        font-size: 12px;
        font-family: monospace;
      }

      .visual-box {
        border: 1px dashed hsl(var(--border));
        padding: 8px;
        margin-bottom: 4px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .visual-box.stream {
        background: hsl(var(--secondary) / 0.5);
      }
      .visual-box.input {
        background: hsl(var(--primary) / 0.15);
      }
      .visual-box.shrink {
        height: 60px;
      }
      .visual-box.grow {
        height: 100px;
      }

      /* Document editor modal */
      .doc-editor-overlay {
        position: fixed;
        inset: 0;
        background: hsl(var(--background) / 0.9);
        backdrop-filter: blur(8px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .doc-editor-overlay.visible {
        display: flex;
      }

      .doc-editor {
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      }

      .doc-editor-header {
        padding: 16px 20px;
        border-bottom: 1px solid hsl(var(--border));
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: hsl(var(--secondary));
      }

      .doc-editor-title {
        font-size: 16px;
        font-weight: 600;
      }

      .doc-editor-actions {
        display: flex;
        gap: 8px;
      }

      .doc-action-btn {
        padding: 6px 12px;
        background: transparent;
        border: 1px solid hsl(var(--border));
        border-radius: 6px;
        color: hsl(var(--foreground));
        font-size: 13px;
        cursor: pointer;
        transition: all 0.15s;
      }

      .doc-action-btn:hover {
        background: hsl(var(--accent));
      }

      .doc-action-btn.primary {
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
        border-color: hsl(var(--primary));
      }

      .doc-editor-toolbar {
        padding: 12px 20px;
        border-bottom: 1px solid hsl(var(--border));
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
      }

      .toolbar-btn {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        border-radius: 6px;
        color: hsl(var(--muted-foreground));
        cursor: pointer;
        transition: all 0.15s;
      }

      .toolbar-btn:hover {
        background: hsl(var(--accent));
        color: hsl(var(--foreground));
      }

      .toolbar-divider {
        width: 1px;
        background: hsl(var(--border));
        margin: 0 8px;
      }

      .doc-editor-body {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        min-height: 300px;
      }

      .doc-editor-body [contenteditable] {
        outline: none;
        min-height: 260px;
        font-size: 15px;
        line-height: 1.7;
      }

      .doc-editor-body [contenteditable]:empty::before {
        content: "Start writing your message...";
        color: hsl(var(--muted-foreground));
      }

      .doc-editor-footer {
        padding: 12px 20px;
        border-top: 1px solid hsl(var(--border));
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: hsl(var(--secondary));
      }

      .doc-footer-info {
        font-size: 12px;
        color: hsl(var(--muted-foreground));
      }

      .doc-footer-actions {
        display: flex;
        gap: 8px;
      }

      /* Expand button in input */
      .expand-btn {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: 1px solid hsl(var(--border));
        border-radius: 8px;
        color: hsl(var(--muted-foreground));
        cursor: pointer;
        transition: all 0.15s;
        flex-shrink: 0;
      }

      .expand-btn:hover {
        background: hsl(var(--accent));
        color: hsl(var(--foreground));
        border-color: hsl(var(--primary) / 0.3);
      }

      /* Behavior diagrams */
      .behavior-diagram {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-top: 24px;
      }

      .behavior-row {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .behavior-label {
        width: 120px;
        font-size: 13px;
        color: hsl(var(--muted-foreground));
        flex-shrink: 0;
      }

      .behavior-bar {
        flex: 1;
        height: 40px;
        background: hsl(var(--secondary));
        border-radius: 8px;
        position: relative;
        overflow: hidden;
      }

      .behavior-fill {
        height: 100%;
        background: hsl(var(--primary) / 0.3);
        border-right: 2px solid hsl(var(--primary));
        transition: width 0.3s ease;
      }

      .behavior-marker {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 10px;
        color: hsl(var(--foreground));
        white-space: nowrap;
      }

      /* Inline ref in doc editor */
      .inline-ref {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        background: hsl(var(--primary) / 0.15);
        border: 1px solid hsl(var(--primary) / 0.3);
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        color: hsl(var(--primary));
        vertical-align: middle;
      }

      /* Annotations */
      .annotation {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        background: hsl(38 80% 50% / 0.15);
        border: 1px solid hsl(38 80% 50% / 0.4);
        border-radius: 6px;
        font-size: 12px;
        color: hsl(38 80% 60%);
        margin-top: 12px;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
      }

      @media (max-width: 900px) {
        .grid-2,
        .comparison {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <h1>Input Growth Behavior</h1>
    <p class="subtitle">Exploring how the message input grows with content and attachments</p>

    <!-- Section 1: Growth Strategy Comparison -->
    <div class="section">
      <h2 class="section-title">Growth Strategy: Push vs. Overlay</h2>
      <p class="section-desc">
        When attachments are added or the input expands, should the stream view shrink (push) or should the input
        overlay the messages?
      </p>

      <div class="comparison">
        <div class="comparison-item">
          <div class="comparison-header">Option A: Push (Recommended)</div>
          <div class="comparison-content">
            <p class="comparison-desc">
              The stream view shrinks as the input grows. Messages stay fully visible but less vertical space. This is
              how Slack, Discord, and most chat apps work.
            </p>
            <div class="comparison-visual">
              <div class="visual-box stream" id="pushStream">Stream View (shrinks)</div>
              <div class="visual-box input" id="pushInput">Input (grows up)</div>
            </div>
            <div class="annotation" style="margin-top: 16px">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
              </svg>
              Messages auto-scroll to bottom as input grows
            </div>
          </div>
        </div>

        <div class="comparison-item">
          <div class="comparison-header">Option B: Overlay</div>
          <div class="comparison-content">
            <p class="comparison-desc">
              Input overlays the bottom of the stream. More vertical space for messages but obscures recent ones. Can
              feel disorienting.
            </p>
            <div class="comparison-visual">
              <div class="visual-box stream">Stream View (fixed)</div>
              <div
                class="visual-box input"
                style="margin-top: -20px; position: relative; z-index: 1; box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3)"
              >
                Input (overlays)
              </div>
            </div>
            <div
              class="annotation"
              style="
                margin-top: 16px;
                background: hsl(0 60% 50% / 0.15);
                border-color: hsl(0 60% 50% / 0.4);
                color: hsl(0 60% 60%);
              "
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
              </svg>
              Obscures messages you might be replying to
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 2: Interactive Demo -->
    <div class="section">
      <h2 class="section-title">Interactive Demo: Push Behavior</h2>
      <p class="section-desc">
        Try adding attachments and text to see how the input grows and the stream view adjusts.
      </p>

      <div class="controls">
        <button class="control-btn" onclick="addAttachment()">+ Add Attachment</button>
        <button class="control-btn" onclick="addUploadingAttachment()">+ Add Uploading</button>
        <button class="control-btn" onclick="clearAttachments()">Clear Attachments</button>
        <button class="control-btn" onclick="addTextLines()">+ Add Text Lines</button>
        <button class="control-btn" onclick="clearText()">Clear Text</button>
        <button class="control-btn" onclick="openDocEditor()">Open Doc Editor</button>
      </div>

      <div class="demo-container" style="position: relative">
        <div class="stream-view" id="streamView">
          <div class="message">
            <div class="message-author">Sarah Chen</div>
            <div>Hey team, just pushed the new auth changes. Can someone review?</div>
          </div>
          <div class="message">
            <div class="message-author">Marcus Johnson</div>
            <div>I'll take a look! Give me 10 minutes.</div>
          </div>
          <div class="message">
            <div class="message-author">Ariadne</div>
            <div>
              I've analyzed the changes. The token refresh logic looks solid. One suggestion: consider adding a retry
              mechanism for network failures.
            </div>
          </div>
          <div class="message">
            <div class="message-author">Sarah Chen</div>
            <div>Good catch! I'll add that in a follow-up PR.</div>
          </div>
          <div class="message">
            <div class="message-author">Marcus Johnson</div>
            <div>LGTM! Approved. The error handling is much cleaner now.</div>
          </div>
        </div>

        <div class="input-wrapper" id="inputWrapper">
          <div class="attachment-bar" id="attachmentBar"></div>
          <div class="input-area">
            <button class="expand-btn" onclick="openDocEditor()" title="Expand to document editor">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9" />
                <polyline points="9 21 3 21 3 15" />
                <line x1="21" y1="3" x2="14" y2="10" />
                <line x1="3" y1="21" x2="10" y2="14" />
              </svg>
            </button>
            <div
              class="input-field"
              id="inputField"
              contenteditable="true"
              data-placeholder="Message #auth-dev..."
            ></div>
            <button class="send-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13" />
                <polygon points="22 2 15 22 11 13 2 9 22 2" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 3: Height Limits -->
    <div class="section">
      <h2 class="section-title">Height Limits & Thresholds</h2>
      <p class="section-desc">The input area has distinct height limits for different components.</p>

      <div class="behavior-diagram">
        <div class="behavior-row">
          <div class="behavior-label">Text input</div>
          <div class="behavior-bar">
            <div class="behavior-fill" style="width: 40%"></div>
            <span class="behavior-marker" style="left: 8px">40px min</span>
            <span class="behavior-marker" style="left: 40%; transform: translateX(-50%) translateY(-50%)"
              >grows...</span
            >
            <span class="behavior-marker" style="right: 8px">200px max</span>
          </div>
        </div>
        <div class="behavior-row">
          <div class="behavior-label">Attachment bar</div>
          <div class="behavior-bar">
            <div class="behavior-fill" style="width: 30%"></div>
            <span class="behavior-marker" style="left: 8px">0px (hidden)</span>
            <span class="behavior-marker" style="left: 30%; transform: translateX(-50%) translateY(-50%)"
              >~50px (1 row)</span
            >
            <span class="behavior-marker" style="right: 8px">120px max (scrolls)</span>
          </div>
        </div>
        <div class="behavior-row">
          <div class="behavior-label">Total input</div>
          <div class="behavior-bar">
            <div class="behavior-fill" style="width: 25%"></div>
            <span class="behavior-marker" style="left: 8px">64px min</span>
            <span class="behavior-marker" style="right: 8px">~380px max</span>
          </div>
        </div>
      </div>

      <div class="annotation" style="margin-top: 24px">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        Stream view should maintain at least 200px height. Beyond that, input scrolls internally.
      </div>
    </div>

    <!-- Section 4: Document Editor -->
    <div class="section">
      <h2 class="section-title">Document Editor Mode</h2>
      <p class="section-desc">
        For longer messages or announcements, expand into a full document editor. This provides more space, better
        formatting controls, and prevents accidental sends.
      </p>

      <div class="grid-2">
        <div>
          <h3 style="font-size: 14px; margin-bottom: 12px; color: hsl(var(--muted-foreground))">When to use:</h3>
          <ul style="font-size: 14px; color: hsl(var(--foreground)); list-style-position: inside; line-height: 2">
            <li>Writing announcements or updates</li>
            <li>Composing long-form content</li>
            <li>When you want formatting preview</li>
            <li>Including multiple attachments with context</li>
            <li>When accidental send would be costly</li>
          </ul>
        </div>
        <div>
          <h3 style="font-size: 14px; margin-bottom: 12px; color: hsl(var(--muted-foreground))">Features:</h3>
          <ul style="font-size: 14px; color: hsl(var(--foreground)); list-style-position: inside; line-height: 2">
            <li>Full toolbar with formatting options</li>
            <li>Larger editing area (no height limit)</li>
            <li>Explicit "Send" action (no Enter to send)</li>
            <li>Draft auto-save</li>
            <li>Preview mode before sending</li>
          </ul>
        </div>
      </div>

      <button class="control-btn" style="margin-top: 24px" onclick="openDocEditor()">Open Document Editor Demo</button>
    </div>

    <!-- Document Editor Modal -->
    <div class="doc-editor-overlay" id="docEditorOverlay" onclick="closeDocEditor(event)">
      <div class="doc-editor" onclick="event.stopPropagation()">
        <div class="doc-editor-header">
          <div class="doc-editor-title">Compose Message</div>
          <div class="doc-editor-actions">
            <button class="doc-action-btn" onclick="closeDocEditor()">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                style="vertical-align: middle"
              >
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
              Cancel
            </button>
            <button class="doc-action-btn">Preview</button>
            <button class="doc-action-btn primary">Send Message</button>
          </div>
        </div>
        <div class="doc-editor-toolbar">
          <button class="toolbar-btn" title="Bold"><strong>B</strong></button>
          <button class="toolbar-btn" title="Italic"><em>I</em></button>
          <button class="toolbar-btn" title="Strikethrough"><s>S</s></button>
          <button class="toolbar-btn" title="Code">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="16 18 22 12 16 6" />
              <polyline points="8 6 2 12 8 18" />
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button class="toolbar-btn" title="Heading 1">H1</button>
          <button class="toolbar-btn" title="Heading 2">H2</button>
          <button class="toolbar-btn" title="Heading 3">H3</button>
          <div class="toolbar-divider"></div>
          <button class="toolbar-btn" title="Bullet list">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6" />
              <line x1="8" y1="12" x2="21" y2="12" />
              <line x1="8" y1="18" x2="21" y2="18" />
              <circle cx="3" cy="6" r="1" fill="currentColor" />
              <circle cx="3" cy="12" r="1" fill="currentColor" />
              <circle cx="3" cy="18" r="1" fill="currentColor" />
            </svg>
          </button>
          <button class="toolbar-btn" title="Numbered list">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="10" y1="6" x2="21" y2="6" />
              <line x1="10" y1="12" x2="21" y2="12" />
              <line x1="10" y1="18" x2="21" y2="18" />
              <text x="3" y="8" font-size="8" fill="currentColor">1</text>
              <text x="3" y="14" font-size="8" fill="currentColor">2</text>
              <text x="3" y="20" font-size="8" fill="currentColor">3</text>
            </svg>
          </button>
          <button class="toolbar-btn" title="Quote">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 17h3l2-4V7H5v6h3" />
              <path d="M15 17h3l2-4V7h-6v6h3" />
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button class="toolbar-btn" title="Link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
            </svg>
          </button>
          <button class="toolbar-btn" title="Attach file">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path
                d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"
              />
            </svg>
          </button>
          <button class="toolbar-btn" title="Mention">@</button>
          <button class="toolbar-btn" title="Emoji">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <path d="M8 14s1.5 2 4 2 4-2 4-2" />
              <line x1="9" y1="9" x2="9.01" y2="9" />
              <line x1="15" y1="9" x2="15.01" y2="9" />
            </svg>
          </button>
        </div>
        <div class="doc-editor-body">
          <div contenteditable="true" id="docEditorContent">
            <p><strong>Weekly Update - Auth Team</strong></p>
            <br />
            <p>Hi team,</p>
            <br />
            <p>Here's what we accomplished this week:</p>
            <br />
            <p>â€¢ Completed token refresh refactor <span class="inline-ref">ðŸ“Ž auth-refactor.md</span></p>
            <p>â€¢ Fixed race condition in session management</p>
            <p>â€¢ Added retry mechanism for network failures</p>
            <br />
            <p>See the attached diagram for the new flow: <span class="inline-ref">ðŸ–¼ auth-flow.png</span></p>
          </div>
        </div>
        <div class="doc-editor-footer">
          <div class="doc-footer-info">
            <span>Posting to <strong>#auth-dev</strong></span>
            <span style="margin-left: 16px; opacity: 0.7">2 attachments</span>
          </div>
          <div class="doc-footer-actions">
            <button class="doc-action-btn" style="font-size: 12px">Schedule send</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let attachmentCount = 0
      const fileNames = ["screenshot.png", "report.xlsx", "design-v2.fig", "notes.md", "recording.mp4", "data.json"]

      function addAttachment() {
        const bar = document.getElementById("attachmentBar")
        bar.classList.add("has-attachments")

        const fileName = fileNames[attachmentCount % fileNames.length]
        const chip = document.createElement("div")
        chip.className = "attachment-chip"
        chip.innerHTML = `
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
        <span>${fileName}</span>
        <span class="remove" onclick="removeAttachment(this)">Ã—</span>
      `
        bar.appendChild(chip)
        attachmentCount++

        scrollStreamToBottom()
      }

      function addUploadingAttachment() {
        const bar = document.getElementById("attachmentBar")
        bar.classList.add("has-attachments")

        const chip = document.createElement("div")
        chip.className = "attachment-chip uploading"
        chip.innerHTML = `
        <div class="spinner"></div>
        <span>Uploading...</span>
      `
        bar.appendChild(chip)

        // Simulate upload completion
        setTimeout(() => {
          chip.classList.remove("uploading")
          const fileName = fileNames[attachmentCount % fileNames.length]
          chip.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          <span>${fileName}</span>
          <span class="remove" onclick="removeAttachment(this)">Ã—</span>
        `
          attachmentCount++
        }, 2000)

        scrollStreamToBottom()
      }

      function removeAttachment(el) {
        const chip = el.parentElement
        chip.remove()

        const bar = document.getElementById("attachmentBar")
        if (bar.children.length === 0) {
          bar.classList.remove("has-attachments")
        }

        scrollStreamToBottom()
      }

      function clearAttachments() {
        const bar = document.getElementById("attachmentBar")
        bar.innerHTML = ""
        bar.classList.remove("has-attachments")
        attachmentCount = 0

        scrollStreamToBottom()
      }

      function addTextLines() {
        const input = document.getElementById("inputField")
        const currentText = input.innerText
        const newLines = currentText
          ? "\n\nAdding more text here to demonstrate the input growing."
          : "This is some text to demonstrate the input growing.\n\nIt can span multiple lines."
        input.innerText = currentText + newLines

        // Place cursor at end
        const range = document.createRange()
        const sel = window.getSelection()
        range.selectNodeContents(input)
        range.collapse(false)
        sel.removeAllRanges()
        sel.addRange(range)

        scrollStreamToBottom()
      }

      function clearText() {
        const input = document.getElementById("inputField")
        input.innerHTML = ""
        scrollStreamToBottom()
      }

      function scrollStreamToBottom() {
        const stream = document.getElementById("streamView")
        setTimeout(() => {
          stream.scrollTop = stream.scrollHeight
        }, 50)
      }

      function openDocEditor() {
        document.getElementById("docEditorOverlay").classList.add("visible")
      }

      function closeDocEditor(event) {
        if (!event || event.target === document.getElementById("docEditorOverlay")) {
          document.getElementById("docEditorOverlay").classList.remove("visible")
        }
      }

      // Close on Escape
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          closeDocEditor()
        }
      })

      // Auto-scroll stream on input changes
      const inputField = document.getElementById("inputField")
      const observer = new MutationObserver(scrollStreamToBottom)
      observer.observe(inputField, { childList: true, subtree: true, characterData: true })
    </script>
  </body>
</html>
